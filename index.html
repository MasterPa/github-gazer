<!DOCTYPE html>
<html lang='en-US'>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' href='https://pingao777.github.io/github-gazer/assets/css/style.css?v=83f9436b2e1b1a48c5227dc3037dbc5f1a9b5db1'>
    <!-- Begin Jekyll SEO tag v2.5.0 -->
    <title>Be proud of you repository history | github-gazer</title>
    <meta name='generator' content='Jekyll v3.7.3.1'/>
    <meta property='og:title' content='Be proud of you repository history | github-gazer'/>
    <meta property='og:locale' content='en_US'/>
    <link rel='canonical' href='https://pingao777.github.io/github-gazer/'/>
    <meta property='og:url' content='https://pingao777.github.io/github-gazer/'/>
    <meta property='og:site_name' content='github-gazer'/>
    <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
    <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/echarts/4.1.0/echarts.min.js'></script>
    <script type='text/javascript' src='index.js'></script>
    <script type='application/ld+json'>
{'@type':'WebSite','headline':'Welcome to GitHub Pages','url':'https://pingao777.github.io/github-gazer/','name':'github-gazer','@context':'http://schema.org'}


    </script>
    <!-- End Jekyll SEO tag -->
</head>
<body>
<a href='https://github.com/pingao777/github-gazer'><img style='position: absolute; top: 0; right: 0; border: 0;' src='https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png' alt='Fork me on GitHub'></a>
<div class='container'>
    <section id='main_content'>
        <div id='star-watch-fork-chart' style='width: 50%;height:200px; margin-top: 20px; float: left;'></div>
        <div id='follower-following-chart' style='width: 50%;height:200px; margin-top: 20px; float: left;'></div>
        <div id='star-chart' style='width: 100%;height:400px; float: left;'></div>

        <script type='text/javascript'>
            var display_star_chart = function (q, data) {
                var myChart = echarts.init(document.getElementById('star-chart'), 'dark');

                var option = {
                    backgroundColor: 'rgba(0,0,0,0.0)',

                    title: {
                        text: 'Stargazers Trend',
                        subtext: q,
                        sublink: 'https://github.com/' + q,
                        left: '10%',  // 不要用right，否则副标题不显示
                        top: '1%'  // 不要用bottom，否则副标题不显示
                    },
                    tooltip: {trigger: 'axis'},
                    grid: {},
                    xAxis: {
                        type: 'time',
                        axisLine: {onZero: false},
                        axisLabel: {
                            formatter: function (value, index) {
                                // 格式化成月/日，只在第一个刻度显示年份
                                var date = new Date(value);
                                var texts = [date.getFullYear(), (date.getMonth() + 1), date.getDate()];
                                return texts.join('-');
                            }
                        }
                    },
                    yAxis: {
                        type: 'value',
                        axisLine: {onZero: false}
                    },
                    dataZoom: [
                        {
                            type: 'slider',
                            xAxisIndex: 0,
                            filterMode: 'empty'
                        },
                        {
                            type: 'inside',
                            xAxisIndex: 0,
                            filterMode: 'empty'
                        }
                    ],
                    series: [
                        {
                            id: 'a',
                            type: 'line',
//                            smooth: true,
                            symbolSize: 0,
                            data: data,
                            color: 'rgba(40,167,69,1.0)',
                            tooltip: {
                                formatter: function (params) {
                                    var date = new Date(params.value[0]);
                                    return ' （'
                                        + date.getFullYear() + '-'
                                        + (date.getMonth() + 1) + '-'
                                        + date.getDate() + ' '
                                        + date.getHours() + ':'
                                        + date.getMinutes()
                                        + '）<br/>'
                                        + params.value[1];
                                }
                            }
                        }
                    ]
                };


                // 使用刚指定的配置项和数据显示图表。
                myChart.setOption(option);
            };

            var display_star_watch_fork_chart = function (q, stars_count, watches_count, forks_count) {
                var myChart = echarts.init(document.getElementById('star-watch-fork-chart'), 'dark');
                var option = {
                    backgroundColor: 'rgba(0,0,0,0.0)',
                    tooltip: {},
                    radar: {
                        shape: 'circle',
                        name: {
                            textStyle: {
                                color: '#fff',
                                //                            backgroundColor: '#999',
                                borderRadius: 3,
                                fontSize: 10
                                //                            padding: [3, 5]
                            }
                        },
                        indicator: [
                            {name: 'Star', max: Math.max(stars_count, watches_count, forks_count)},
                            {name: 'Watch', max: Math.max(stars_count, watches_count, forks_count)},
                            {name: 'Fork', max: Math.max(stars_count, watches_count, forks_count)}
                        ],
                        splitLine: {
                            lineStyle: {
                                color: [
                                    'rgba(45, 234, 148, 0.1)', 'rgba(45, 234, 148, 0.2)',
                                    'rgba(45, 234, 148, 0.4)', 'rgba(45, 234, 148, 0.6)',
                                    'rgba(45, 234, 148, 0.8)', 'rgba(45, 234, 148, 1)'
                                ].reverse()
                            }
                        },
                        splitArea: {
                            show: false
                        },
                        axisLine: {
                            lineStyle: {
                                color: 'rgba(45, 234, 148, 0.5)'
                            }
                        }
                    },
                    series: [{
                        name: 'Activity',
                        type: 'radar',
                        symbolSize: 0,
                        itemStyle: {normal: {areaStyle: {type: 'default'}}},
                        data: [
                            {
                                value: [stars_count, watches_count, forks_count],
                                name: 'Activity'
                            }
                        ],
                        color: 'rgba(40,167,69,1.0)'

                    }]
                };

                myChart.setOption(option);
            };

            var display_follower_following_chart = function (q, follower_count, following_count) {
                var myChart = echarts.init(document.getElementById('follower-following-chart'), 'dark');

                var option = {
                    backgroundColor: 'rgba(0,0,0,0.0)',
                    tooltip: {
                        trigger: 'item',
                        formatter: '{a} <br/>{b}: {c}'
                    },
                    color: ['#005cc5', '#28a745'],
                    series: [
                        {
                            name: 'Relation',
                            type: 'pie',
                            radius: ['50%', '70%'],
                            avoidLabelOverlap: false,
                            label: {
                                normal: {
                                    show: true,
                                    formatter: '{b}: {c}'
                                }
                            },
                            labelLine: {
                                normal: {
                                    show: true
                                }
                            },
                            data: [
                                {value: follower_count, name: 'Follower'},
                                {value: following_count, name: 'Following'}
                            ]
                        }
                    ]
                };

                myChart.setOption(option);
            };


            var query = parse_query(window.location.search);
            var q = is_empty(query['q']) ? 'pingao777/markdown-preview-sync' : query['q'];
            var access_token = is_empty(query['access_token']) ? '' : query['access_token'];

            var get_stargazers = function (q, access_token) {

                var stargazers = [];
                var page = 1;
                var page_size = 100;
                var url = 'https://api.github.com/repos/' + q + '/stargazers?per_page=' + page_size + '&page=' + page
                    + (is_empty(access_token) ? '' : '&access_token=' + access_token);
                var result = query_github_api(url);

                while (result.length !== 0) {
                    var stargazers_per_page = result.map(function (e, i) {
                        return [e.starred_at.replace('T', ' ').replace('Z', ''), i + 1 + (page - 1) * 100]
                    });
                    stargazers = stargazers.concat(stargazers_per_page);
                    page++;
                    url = 'https://api.github.com/repos/' + q + '/stargazers?per_page=' + page_size + '&page=' + page
                        + (is_empty(access_token) ? '' : '&access_token=' + access_token);
                    result = query_github_api(url);
                }

                return stargazers;
            };

            var get_forks_count = function (q, access_token) {
                var forks_count = 0;
                var user = q.split('/')[0];
                var repo = q.split('/')[1];
                var url = 'https://api.github.com/search/repositories?q=user:' + user + '+repo:' + repo + '+' + repo
                    + (is_empty(access_token) ? '' : '&access_token=' + access_token);
                var result = query_github_api(url);

                if (result.length !== 0) {
                    forks_count = result['items'][0]['forks_count'];
                }

                return forks_count;
            };

            var get_watches_count = function (q, access_token) {
                var watches_count = 0;
                var page = 1;
                var page_size = 100;
                var url = 'https://api.github.com/repos/' + q + '/subscribers?per_page=' + page_size + '&page=' + page
                    + (is_empty(access_token) ? '' : '&access_token=' + access_token);
                var result = query_github_api(url);

                while (result.length !== 0) {
                    watches_count += result.length;
                    page++;
                    url = 'https://api.github.com/repos/' + q + '/subscribers?per_page=' + page_size + '&page=' + page
                        + (is_empty(access_token) ? '' : '&access_token=' + access_token);
                    result = query_github_api(url);
                }

                return watches_count;
            };

            var get_follower_following_count = function (q, access_token) {
                var follower_count = 0;
                var following_count = 0;
                var user = q.split('/')[0];
                var url = 'https://api.github.com/users/' + user
                    + (is_empty(access_token) ? '' : '?access_token=' + access_token);
                var result = query_github_api(url);

                if (result.length !== 0) {
                    follower_count = result['followers'];
                    following_count = result['following'];
                }

                return [follower_count, following_count];
            };


            //        var stargazers = [1, 2];
            var stargazers = get_stargazers(q, access_token);
            var watches_count = get_watches_count(q, access_token);
            var forks_count = get_forks_count(q, access_token);
            var follower_following = get_follower_following_count(q, access_token);

            display_star_watch_fork_chart(q, stargazers.length, watches_count, forks_count);
            display_follower_following_chart(q, 0, 0);
            display_star_chart(q, stargazers);
        </script>
    </section>
</div>
</body>
</html>
